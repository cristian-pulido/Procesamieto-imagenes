{% extends 'base/base.html' %}



{% block title %} Lista Archivos {% endblock %}
{% block content %}

{% load scripts %}


{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <div class="alert alert-success">
    {{ message }}
  </div>
    {% endfor %}
</ul>
{% endif %}



<button style="vertical-align: middle;" type="button" onclick="location.href='{% url 'carga' %}'" class="btn btn-success"><i class="glyphicon glyphicon-plus"></i> Añadir Registro</button>



{% get_archivos user.pk as archivos %}

{% get_archivos_group user.pk as archivos_group %}



<br><br>

<table class="table table-hover">
    {% if archivos|length == 0 %}
    <legend>No se encontraron Estudios Propios</legend>

    {% else %}
    
    <legend>Mis Estudios</legend>
    
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Nombre</th>
      <th scope="col"> Acciones </th>
      
    </tr>
  </thead>
  <tbody>

  	{% for item in archivos %}
    
    <tr class="table-primary">
      {% if item.no_dicom == True %}  
        <td style="vertical-align: middle;">
            <form>
          <button class="btn btn-link enabled" formaction="#" title="No se encontro archivos DICOM">{{ forloop.counter }}
          </button>
        </form>
        </td>
      
      {% elif not item.identificado  %}  
            {% if item.user.pk == user.pk  %}
                <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="{% url 'picture' item.pk%}" title="Ver información">{{ forloop.counter }}
                  </button>
                </form>
              </td>
            {% else %}
                <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="#" title="Falta Clasificación de Imágenes por el propietario">{{ forloop.counter }}
                  </button>
                </form>
              </td>
            {% endif%}
      {% elif item.identificado  %}  
        <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="{% url 'picture' item.pk%}" title="Ver información">{{ forloop.counter }}
                  </button>
                </form>
              </td>
      {% else %}
      <td style="vertical-align: middle;">
        <form>
          <button class="btn btn-link enabled" formaction="#" title="Aun en Proceso">{{ forloop.counter }}
          </button>
        </form>
      </td>
      {% endif%}
      <td style="vertical-align: middle;">{{item.get_name}}</td>
      <td>
      	<form>
            {% if item.anonimo == 1 and perms.validacion.can_ver_slice %}
              <button class="btn btn-info"  formaction="{% url 'img_to_show' item.pk %}" title="Ver Imágenes">
              <i class="glyphicon glyphicon-eye-open"></i>
              </button>
              {% endif %}
            
      		{% if item.anonimo == True %}
  		<button class="btn btn-success"  formaction="{{ item.file.url }}" title="Descargar">
              <i class="glyphicon glyphicon-download"></i>
              </button>
            {% endif %}
      	<button class="btn btn-danger"  formaction="{% url 'upload-delete' item.pk %}" title="Eliminar">
                                  <i class="glyphicon glyphicon-trash"></i>

                                  </button>

          </form>

      </td>
    </tr>

    {% endfor %}
    {% endif %}     
      
  </tbody>
    {% if archivos_group|length > 0 %}
   
    
    <tr><td colspan="4"> <legend>Estudios compartidos conmigo</legend></td></tr>
    
    
    <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Nombre</th>
      
      <th scope="col"> Acciones </th>
        <th scope="col">Usuario</th>
    </tr>
  </thead>
    <tbody>

  	{% for item in archivos_group %}
    
    <tr class="table-primary">
      {% if item.no_dicom == True %}  
        <td style="vertical-align: middle;">
            <form>
          <button class="btn btn-link enabled" formaction="#" title="No se encontro archivos DICOM">{{ forloop.counter }}
          </button>
        </form>
        </td>
      
      {% elif not item.identificado  %}  
            {% if item.user.pk == user.pk  %}
                <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="{% url 'picture' item.pk%}" title="Ver información">{{ forloop.counter }}
                  </button>
                </form>
              </td>
            {% else %}
                <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="#" title="Falta Clasificación de Imágenes por el propietario">{{ forloop.counter }}
                  </button>
                </form>
              </td>
            {% endif%}
      {% elif item.identificado  %}  
        <td style="vertical-align: middle;">
                <form>
                  <button class="btn btn-link enabled" formaction="{% url 'picture' item.pk%}" title="Ver información">{{ forloop.counter }}
                  </button>
                </form>
              </td>
      {% else %}
      <td style="vertical-align: middle;">
        <form>
          <button class="btn btn-link enabled" formaction="#" title="Aun en Proceso">{{ forloop.counter }}
          </button>
        </form>
      </td>
      {% endif%}
      <td style="vertical-align: middle;">{{item.get_name}}</td>
        
      <td>
      	<form>
            {% if item.anonimo == 1 and perms.validacion.can_ver_slice %}
              <button class="btn btn-info"  formaction="{% url 'img_to_show' item.pk %}" title="Ver Imágenes">
              <i class="glyphicon glyphicon-eye-open"></i>
              </button>
              {% endif %}
            
      		{% if item.anonimo == True %}
  		<button class="btn btn-success"  formaction="{{ item.file.url }}" title="Descargar">
              <i class="glyphicon glyphicon-download"></i>
              </button>
            {% endif %}
      

          </form>

      </td>
        <td style="vertical-align: middle;">{{item.user.first_name}}</td>
    </tr>

    {% endfor %}
    
  </tbody>
    {% endif %} 
</table>


{% endblock %}